<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <menuitem id="menu_saas" name="SaaS" sequence="40"/>

        <menuitem id="menu_saas_saas" name="SaaS" parent="menu_saas" sequence="5"/>


        <record id="action_saas_base_form" model="ir.actions.act_window">
            <field name="name">Bases</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.base</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_base_form" id="menu_action_saas_base_form" parent="menu_saas_saas"/>


        <record id="view_saas_base_form" model="ir.ui.view">
            <field name="name">saas.base.form</field>
            <field name="model">saas.base</field>
            <field name="arch" type="xml">
                <form string="Base" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="title"/>
                        <field name="domain_id"/>
                        <field name="application_id"/>
                        <field name="service_id" required="0"/>
                        <field name="service_ids" widget="many2many_tags"/>
                        <field name="proxy_id"/>
                        <field name="mail_id"/>
                        <field name="admin_passwd"/>
                        <field name="poweruser_name"/>
                        <field name="poweruser_passwd"/>
                        <field name="poweruser_email"/>
                        <field name="build"/>
                        <field name="lang"/>
                        <field name="ssl_only"/>
                        <field name="nosave"/>
                        <field name="test"/>
                        <field name="reset_each_day"/>
                        <newline/>
                        <field name="cert_key"/>
                        <field name="cert_cert"/>
                        <newline/>
                        <field name="parent_id"/>
                        <button name="reset_base" string="Reset from parent" type="object" attrs="{'invisible': [('parent_id','=',False)]}"/>
                    </group>
                    <field name="option_ids" colspan="4">
                        <tree string="Options" editable="bottom">
                            <field name="name" domain="[('apptype_id.application_ids.container_ids.service_ids','in',parent.service_id),('type','=','base')]"/>
                            <field name="value"/>
                        </tree>
                    </field>
                    <group col="4">
                        <field name="save_repository_id"/>
                        <field name="time_between_save"/>
                        <field name="saverepo_change"/>
                        <field name="saverepo_expiration"/>
                        <newline/>
                        <field name="date_next_save"/>
                        <field name="save_comment"/>
                    </group>
                    <button name="save" string="Save" type="object"/>
                    <button name="reinstall" string="Reinstall" type="object"/>
                    <button name="reset_proxy" string="Reset Proxy" type="object"/>
                    <button name="reset_bind" string="Reset DNS" type="object"/>
                    <button name="reset_shinken" string="Reset Shinken" type="object"/>
                    <button name="reset_mail" string="Reset Mail" type="object"/>
                    <button name="reset_bases" string="Reset Bases" type="object"/>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_base_tree" model="ir.ui.view">
            <field name="name">saas.base.tree</field>
            <field name="model">saas.base</field>
            <field name="arch" type="xml">
                <tree string="Base">
                        <field name="name"/>
                        <field name="domain_id"/>
                        <field name="state"/>
                </tree>
            </field>
        </record>


        <record id="action_saas_service_form" model="ir.actions.act_window">
            <field name="name">Services</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.service</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_service_form" id="menu_action_saas_service_form" parent="menu_saas_saas"/>

        <record id="view_saas_service_form" model="ir.ui.view">
            <field name="name">saas.service.form</field>
            <field name="model">saas.service</field>
            <field name="arch" type="xml">
                <form string="Service" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="container_id"/>
                        <field name="application_id"/>
                        <field name="application_version_id" domain="[('application_id.container_ids','=',container_id)]"/>
                        <field name="database_container_id"/>
                        <field name="database_password"/>
                        <newline/>
                        <field name="custom_version"/>
                        <newline/>
                        <field name="parent_id"/>
                        <button name="deploy_to_parent" string="Deploy to parent" type="object" attrs="{'invisible': [('parent_id','=', False)]}"/>
                    </group>
                    <group col="4" attrs="{'invisible': [('parent_id','!=', False)]}">
                        <button name="install_formation" string="Install Formation" type="object"/>
                        <button name="install_test" string="Install Test" type="object"/>
                        <newline/>
                        <field name="sub_service_name"/>
                        <button name="install_subservice" string="Install Subservice" type="object"/>
                    </group>
                    <field name="option_ids" colspan="4">
                        <tree string="Options" editable="bottom">
                            <field name="name" domain="[('apptype_id.application_ids.container_ids','in',parent.container_id),('type','=','service')]"/>
                            <field name="value"/>
                        </tree>
                    </field>
                    <button name="reinstall" string="Reinstall" type="object"/>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_service_tree" model="ir.ui.view">
            <field name="name">saas.service.tree</field>
            <field name="model">saas.service</field>
            <field name="arch" type="xml">
                <tree string="Services">
                    <field name="name"/>
                    <field name="application_id"/>
                    <field name="container_id"/>
                </tree>
            </field>
        </record>



        <record id="action_saas_container_form" model="ir.actions.act_window">
            <field name="name">Containers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.container</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_container_form" id="menu_action_saas_container_form" parent="menu_saas_saas"/>

        <record id="view_saas_container_form" model="ir.ui.view">
            <field name="name">saas.container.form</field>
            <field name="model">saas.container</field>
            <field name="arch" type="xml">
                <form string="Container" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="application_id" on_change="onchange_application_id(application_id)"/>
                        <field name="server_id"/>
                        <field name="linked_container_ids" widget="many2many_tags"/>
                        <field name="image_id"/>
                        <field name="image_version_id" domain="[('image_id','=',image_id)]"/>
                        <field name="nosave"/>
                    </group>
                    <field name="option_ids" colspan="4">
                        <tree string="Options" editable="bottom">
                            <field name="name" domain="[('apptype_id.application_ids','in',parent.application_id),('type','=','container')]"/>
                            <field name="value"/>
                        </tree>
                    </field>
                    <field name="port_ids" colspan="4">
                        <tree string="Ports" editable="bottom">
                            <field name="name"/>
                            <field name="localport"/>
                            <field name="hostport"/>
                            <field name="expose"/>
                            <field name="udp"/>
                        </tree>
                    </field>
                    <field name="volume_ids" colspan="4">
                        <tree string="Volumes" editable="bottom">
                            <field name="name"/>
                            <field name="hostpath"/>
                            <field name="user"/>
                            <field name="readonly"/>
                            <field name="nosave"/>
                        </tree>
                    </field>
                    <group col="4">
                        <field name="save_repository_id"/>
                        <field name="time_between_save"/>
                        <field name="saverepo_change"/>
                        <field name="saverepo_expiration"/>
                        <newline/>
                        <field name="date_next_save"/>
                        <field name="save_comment"/>
                    </group>
                    <button name="save" string="Save" type="object"/>
                    <button name="reinstall" string="Reinstall" type="object"/>
                    <button name="button_stop" string="Stop" type="object"/>
                    <button name="button_start" string="Start" type="object"/>
                    <button name="reset_key" string="Reset Key" type="object"/>
                    <button name="reset_shinken" string="Reset Shinken" type="object"/>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_container_tree" model="ir.ui.view">
            <field name="name">saas.container.tree</field>
            <field name="model">saas.container</field>
            <field name="arch" type="xml">
                <tree string="Containers">
                    <field name="name"/>
                    <field name="server_id"/>
                    <field name="application_id"/>
                    <field name="image_id"/>
                    <field name="image_version_id"/>
                    <field name="ports"/>
                </tree>
            </field>
        </record>


        <record id="action_saas_server_form" model="ir.actions.act_window">
            <field name="name">Servers</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.server</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_server_form" id="menu_action_saas_server_form" parent="menu_saas_saas"/>

        <record id="view_saas_server_form" model="ir.ui.view">
            <field name="name">saas.server.form</field>
            <field name="model">saas.server</field>
            <field name="arch" type="xml">
                <form string="Server" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="ip"/>
                        <field name="ssh_port"/>
                        <field name="mysql_passwd"/>
                    </group>
                    <button name="reinstall" string="Reinstall" type="object"/>
                    <button name="start_containers" string="Start Containers" type="object"/>
                    <button name="stop_containers" string="Stop Containers" type="object"/>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_server_tree" model="ir.ui.view">
            <field name="name">saas.server.tree</field>
            <field name="model">saas.server</field>
            <field name="arch" type="xml">
                <tree string="Servers">
                    <field name="name"/>
                    <field name="ip"/>
                    <field name="ssh_port"/>
                </tree>
            </field>
        </record>

        <record id="action_saas_save_repository_form" model="ir.actions.act_window">
            <field name="name">Save Repositories</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.save.repository</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_save_repository_form" id="menu_action_saas_save_repository_form" parent="menu_saas_saas"/>

        <record id="view_saas_save_repository_form" model="ir.ui.view">
            <field name="name">saas.save.repository.form</field>
            <field name="model">saas.save.repository</field>
            <field name="arch" type="xml">
                <form string="Save Repository" version="7.0">
                    <group col="4">
                      <field name="name"/>
                      <field name="type"/>
                      <field name="date_change"/>
                      <field name="date_expiration"/>
                    </group>
                    <notebook>
                        <page string="Container" attrs="{'invisible':[('type','!=','container')]}">
                            <group col="4">
                              <field name="container_name"/>
                              <field name="container_server"/>
                            </group>  
                        </page>
                        <page string="Base" attrs="{'invisible':[('type','!=','base')]}">
                            <group col="4">
                              <field name="base_name"/>
                              <field name="base_domain"/>
                            </group>  
                        </page>
                     </notebook>
                    <field name="save_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_save_repository_tree" model="ir.ui.view">
            <field name="name">saas.save.repository.tree</field>
            <field name="model">saas.save.repository</field>
            <field name="arch" type="xml">
                <tree string="Save Repository">
                    <field name="name"/>
                    <field name='type'/>
                </tree>
            </field>
        </record>

        <record id="action_saas_save_save_form" model="ir.actions.act_window">
            <field name="name">Saves</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.save.save</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_save_save_form" id="menu_action_saas_save_save_form" parent="menu_saas_saas"/>

        <record id="view_saas_save_save_form" model="ir.ui.view">
            <field name="name">saas.save.save.form</field>
            <field name="model">saas.save.save</field>
            <field name="arch" type="xml">
                <form string="Save" version="7.0">
                    <group col="4">
                      <field name="name"/>
                      <field name="type" invisible="1"/>
                      <field name="repo_id"/>
                      <field name="now_bup"/>
                      <field name='comment'/>
<!--                      <field name="instance_id"/>
                      <field name="saas_ids"/>
                      <field name="create_date"/>
                      <field name="version"/>
                      <field name="application_id" invisible="1"/>
                      <newline/>
                      <newline/>
                      <field name="restore_instance_id" domain="[('application_id','=',application_id)]"/>
                      <field name="restore_prefix"/>
                      <field name="restore_saas_ids" domain="[('id','in',saas_ids[0][2])]"/>-->
                    </group>
                    <notebook>
                        <page string="Container">
                            <group col="4">
                                <field name="container_id"/>
                                <field name="container_app"/>
                                <field name="container_img"/>
                                <field name="container_img_version"/>
                                <field name="container_ports"/>
                                <field name="container_options"/>
                                <field name="container_volumes_comma"/>
                                <field name="container_volumes"/>
                            </group>  
                       </page>
                        <page string="Service" attrs="{'invisible':[('type','!=','base')]}">
                            <group col="4">
                                <field name="service_id"/>
                                <field name="service_name"/>
                                <field name="service_database_id"/>
                                <field name="service_options"/>
                            </group>  
                       </page>
                        <page string="Base" attrs="{'invisible':[('type','!=','base')]}">
                            <group col="4">
                                <field name="base_id"/>
                                <field name="base_title"/>
                                <field name="base_proxy_id"/>
                                <field name="base_app_version"/>
                                <field name="base_admin_passwd"/>
                                <field name="base_poweruser_name"/>
                                <field name="base_poweruser_password"/>
                                <field name="base_poweruser_email"/>
                                <field name="base_build"/>
                                <field name="base_test"/>
                                <field name="base_lang"/>
                                <field name="base_nosave"/>
                                <field name="base_options"/>
                            </group>  
                       </page>
                    </notebook>
                    <group col="4">
                      <separator string="Restore"/>
                      <newline/>
                      <field name="container_name" attrs="{'invisible':[('type','!=','container')]}"/>
                      <field name="container_server" attrs="{'invisible':[('type','!=','container')]}"/>
                      <field name="base_container_name" readonly="1" attrs="{'invisible':[('type','!=','base')]}"/>
                      <field name="base_container_server" readonly="1" attrs="{'invisible':[('type','!=','base')]}"/>
                      <field name="container_restore_to_name"/>
                      <field name="container_restore_to_server_id"/>
                      <field name="base_name" attrs="{'invisible':[('type','!=','base')]}"/>
                      <field name="base_domain" attrs="{'invisible':[('type','!=','base')]}"/>
                      <field name="base_restore_to_name" attrs="{'invisible':[('type','!=','base')]}"/>
                      <field name="base_restore_to_domain_id" attrs="{'invisible':[('type','!=','base')]}"/>
                    </group>
                    <button name="restore" string="Restore" type="object"/>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_save_save_tree" model="ir.ui.view">
            <field name="name">saas.save.save.tree</field>
            <field name="model">saas.save.save</field>
            <field name="arch" type="xml">
                <tree string="Save">
                    <field name="name"/>
                    <field name='type'/>
                    <field name='comment'/>
<!--                    <field name='instance_id'/>
                    <field name="saas_ids"/>
                    <field name="create_date"/>
                    <field name="version"/>-->
                </tree>
            </field>
        </record>



        <menuitem id="menu_saas_configuration" name="Configuration" parent="menu_saas" sequence="10"/>

        <record id="action_saas_domain_form" model="ir.actions.act_window">
            <field name="name">Domains</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.domain</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_domain_form" id="menu_action_saas_domain_form" parent="menu_saas_configuration"/>

        <record id="view_saas_domain_form" model="ir.ui.view">
            <field name="name">saas.domain.form</field>
            <field name="model">saas.domain</field>
            <field name="arch" type="xml">
                <form string="Domain" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="organisation"/>
                        <newline/>
                        <field name="cert_key"/>
                        <field name="cert_cert"/>
                    </group>
                    <button name="reinstall" string="Reinstall" type="object"/>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_domain_tree" model="ir.ui.view">
            <field name="name">saas.domain.tree</field>
            <field name="model">saas.domain</field>
            <field name="arch" type="xml">
                <tree string="Domains">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="action_saas_application_type_form" model="ir.actions.act_window">
            <field name="name">Application types</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.application.type</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_application_type_form" id="menu_action_saas_application_type_form" parent="menu_saas_configuration"/>

        <record id="view_saas_application_type_form" model="ir.ui.view">
            <field name="name">saas.application.type.form</field>
            <field name="model">saas.application.type</field>
            <field name="arch" type="xml">
                <form string="Application type" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="system_user"/>
                        <field name="admin_name"/>
                        <field name="admin_email"/>
                        <field name="mysql"/>
                        <field name="init_test"/>
                        <field name="standard_port"/>
                        <field name="localpath"/>
                        <field name="localpath_services"/>
                    </group>
                    <field name="option_ids" colspan="4">
                        <tree string="Options" editable="bottom">
                            <field name="name"/>
                            <field name="type"/>
                            <field name="default"/>
                        </tree>
                    </field>
                </form>
            </field>
        </record>
        <record id="view_saas_application_type_tree" model="ir.ui.view">
            <field name="name">saas.application.type.tree</field>
            <field name="model">saas.application.type</field>
            <field name="arch" type="xml">
                <tree string="Application types">
                    <field name="name"/>
                </tree>
            </field>
        </record>


        <record id="action_saas_application_form" model="ir.actions.act_window">
            <field name="name">Applications</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.application</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_application_form" id="menu_action_saas_application_form" parent="menu_saas_configuration"/>

        <record id="view_saas_application_form" model="ir.ui.view">
            <field name="name">saas.application.form</field>
            <field name="model">saas.application</field>
            <field name="arch" type="xml">
                <form string="Application" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="code"/>
                        <field name="type_id"/>
                        <field name="current_version"/>
                        <field name="bdd"/>
                        <field name="default_image_id"/>
                        <field name="linked_local_containers"/>
                        <field name="next_server_id"/>
                        <field name="next_database_id"/>
<!--
                        <field name="preprod_domain_id"/>
                        <field name="preprod_server_id"/>
                        <field name="preprod_bdd_server_id"/>
                        <field name="preprod_port"/>
                        <field name="preprod_instance_id"/>
                        <field name="preprod_mysql_instance_id"/>
                        <field name="test_port"/>
                        <field name="test_instance_id"/>
                        <field name="test_mysql_instance_id"/>
                        <field name="dev_port"/>
                        <field name="dev_instance_id"/>
                        <field name="dev_mysql_instance_id"/>-->
                        <field name="instances_path"/>
                        <field name="build_directory"/>
                        <field name="poweruser_name"/>
                        <field name="poweruser_password"/>
                        <field name="poweruser_email"/>
                        <field name="piwik_demo_id"/>
                        <field name="version_prod"/>
                        <field name="version_preprod"/>
                        <field name="version_test"/>
                        <field name="version_dev"/>
                        <newline/>
                        <field name="container_time_between_save"/>
                        <field name="base_time_between_save"/>
                        <field name="container_saverepo_change"/>
                        <field name="base_saverepo_change"/>
                        <field name="container_saverepo_expiration"/>
                        <field name="base_saverepo_expiration"/>
<!--                        <newline/>
                        <button name="refresh_demo" string="Refresh Demo" type="object"/>-->
                    </group>
                    <field name="option_ids" colspan="4">
                        <tree string="Options" editable="bottom">
                            <field name="name" domain="[('apptype_id','=',parent.type_id),('type','=','application')]"/>
                            <field name="value"/>
                        </tree>
                    </field>
                    <field name="buildfile" colspan="4"/>
                    <newline/>
                    <button name="build" string="Build" type="object"/>
                    <field name="version_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_application_tree" model="ir.ui.view">
            <field name="name">saas.application.tree</field>
            <field name="model">saas.application</field>
            <field name="arch" type="xml">
                <tree string="Applications">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record id="action_saas_application_version_form" model="ir.actions.act_window">
            <field name="name">App Versions</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.application.version</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_application_version_form" id="menu_action_saas_application_version_form" parent="menu_saas_configuration"/>

        <record id="view_saas_application_version_form" model="ir.ui.view">
            <field name="name">saas.application.version.form</field>
            <field name="model">saas.application.version</field>
            <field name="arch" type="xml">
                <form string="App Version" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="application_id"/>
                    </group>
                    <button name="build_database" string="Build Database" type="object"/> <!-- TODO Click on this button to generate a build-appcode.yolo-consulting.net, dump the base and save in the archive file so it can be use later by restore method. Then drop build-appcode.yolo-consulting.net.-->
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_application_version_tree" model="ir.ui.view">
            <field name="name">saas.application.version.tree</field>
            <field name="model">saas.application.version</field>
            <field name="arch" type="xml">
                <tree string="App Versions">
                    <field name="name"/>
                    <field name="application_id"/>
                    <field name="service_ids"/>
                </tree>
            </field>
        </record>


        <record id="action_saas_log_form" model="ir.actions.act_window">
            <field name="name">Logs</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.log</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_log_form" id="menu_action_saas_log_form" parent="menu_saas_configuration"/>

        <record id="view_saas_log_form" model="ir.ui.view">
            <field name="name">saas.log.form</field>
            <field name="model">saas.log</field>
            <field name="arch" type="xml">
                <form string="Version" version="7.0">
                    <group col="4">
                        <field name="model"/>
                        <field name="res_id"/>
                        <field name="name"/>
                        <field name="action"/>
                        <field name="create_date"/>
                        <field name="expiration_date"/>
                        <newline/>
                        <field name="log" colspan="4"/>
                        <field name="state"/>
                    </group>
                </form>
            </field>
        </record>
        <record id="view_saas_log_tree" model="ir.ui.view">
            <field name="name">saas.log.tree</field>
            <field name="model">saas.log</field>
            <field name="arch" type="xml">
                <tree string="Versions">
                    <field name="model"/>
                    <field name="res_id"/>
                    <field name="name"/>
                    <field name="action"/>
                    <field name="create_date"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>


        <record id="action_saas_image_form" model="ir.actions.act_window">
            <field name="name">Images</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.image</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_image_form" id="menu_action_saas_image_form" parent="menu_saas_configuration"/>

        <record id="view_saas_image_form" model="ir.ui.view">
            <field name="name">saas.image.form</field>
            <field name="model">saas.image</field>
            <field name="arch" type="xml">
                <form string="Image" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="current_version"/>
                    </group>
                    <field name="dockerfile" colspan="4"/>
                    <field name="volume_ids" colspan="4">
                        <tree string="Volumes" editable="bottom">
                            <field name="name"/>
                            <field name="hostpath"/>
                            <field name="user"/>
                            <field name="readonly"/>
                            <field name="nosave"/>
                        </tree>
                    </field>
                    <field name="port_ids" colspan="4">
                        <tree string="Ports" editable="bottom">
                            <field name="name"/>
                            <field name="localport"/>
                            <field name="expose"/>
                            <field name="udp"/>
                        </tree>
                    </field>
                    <button name="build" string="Build" type="object"/>
                    <field name="version_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_image_tree" model="ir.ui.view">
            <field name="name">saas.image.tree</field>
            <field name="model">saas.image</field>
            <field name="arch" type="xml">
                <tree string="Images">
                    <field name="name"/>
                    <field name="current_version"/>
                </tree>
            </field>
        </record>


        <record id="action_saas_image_version_form" model="ir.actions.act_window">
            <field name="name">Image Versions</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">saas.image.version</field>
            <field name="view_type">form</field>
        </record>

        <menuitem action="action_saas_image_version_form" id="menu_action_saas_image_version_form" parent="menu_saas_configuration"/>

        <record id="view_saas_image_version_form" model="ir.ui.view">
            <field name="name">saas.image.version.form</field>
            <field name="model">saas.image.version</field>
            <field name="arch" type="xml">
                <form string="Image Version" version="7.0">
                    <group col="4">
                        <field name="name"/>
                        <field name="image_id"/>
                    </group>
                    <field name="log_ids" colspan="4"/>
                </form>
            </field>
        </record>
        <record id="view_saas_image_version_tree" model="ir.ui.view">
            <field name="name">saas.image.version.tree</field>
            <field name="model">saas.image.version</field>
            <field name="arch" type="xml">
                <tree string="Image Versions">
                    <field name="image_id"/>
                    <field name="name"/>
                    <field name="container_ids"/>
                </tree>
            </field>
        </record>


        <record id="view_saas_configuration" model="ir.ui.view">
            <field name="name">saas settings</field>
            <field name="model">saas.config.settings</field>
            <field name="arch" type="xml">
                <form string="Application" version="7.0">
                    <group col="4">
                        <field name="conductor_path" required="1"/>
                        <field name="email_sysadmin" required="1"/>
                        <field name="log_path" required="1"/>
                        <field name="archive_path" required="1"/>
                        <field name="services_hostpath" required="1"/>
                        <field name="backup_directory" required="1"/>
                        <field name="piwik_server" required="1"/>
                        <field name="piwik_password" required="1"/>
                        <field name="home_directory" required="1"/>
                        <field name="dns_id"/>
                        <field name="shinken_id"/>
                        <field name="bup_id"/>
                        <field name="ftpuser" required="1"/>
                        <field name="ftppass" required="1"/>
                        <field name="ftpserver" required="1"/>
                        <field name="mailchimp_username" required="1"/>
                        <field name="mailchimp_apikey" required="1"/>
                    </group>
                    <button name="cron_daily" string="Launch daily cron" type="object"/>
                    <button name="upload_save" string="Upload Save" type="object"/>
                    <button name="reset_keys" string="Reset Keys" type="object"/>
                    <button name="reset_bup_key" string="Reset Bup Key" type="object"/>
                    <button name="purge_expired_saverepo" string="Purge expired SaveRepo" type="object"/>
                    <button name="purge_expired_logs" string="Purge Expired Logs" type="object"/>
                    <button name="launch_next_saves" string="Launch Next Saves" type="object"/>
                </form>
            </field>
        </record>

        <record id="saas_settings" model='saas.config.settings'>
            <field name="archive_path">/opt/archives</field>
            <field name="email_sysadmin">yannick.buron@gmail.com</field>
            <field name="services_hostpath">/opt/services</field>
            <field name="conductor_path">/opt/openerp/saas-conductor</field>
            <field name="home_directory">/home/saas-conductor</field>
            <field name="ftpuser">sd-34468</field>
            <field name="ftppass">psSLW9K9DrzX2lQ</field>
            <field name="ftpserver">dedibackup-dc3.online.net</field>
        </record>

        <record id="action_saas_configuration" model="ir.actions.act_window">
            <field name="name">Configure SaaS</field>
            <field name="res_model">saas.config.settings</field>
            <field name="view_id" ref="view_saas_configuration"/>
            <field name="view_mode">form</field>
            <field name="res_id" ref="saas_settings"/>
        </record>

        <menuitem id="menu_saas_admin_configuration" parent="menu_saas_configuration"
            sequence="15" action="action_saas_configuration"/>

        <record id="save_saas_daily_scheduler" model="ir.cron">
          <field name="name">SaaS Daily Cron</field>
          <field eval="1" name="interval_number"/>
          <field name="interval_type">days</field>
          <field eval="-1" name="numbercall"/>
          <field eval="0" name="doall"/>
          <field name="model">saas.config.settings</field>
          <field name="function">cron_daily</field>
          <field name="args">([1])</field>
        </record> 

        <record id="save_saas_nextsaves_scheduler" model="ir.cron">
          <field name="name">SaaS Next Saves</field>
          <field eval="30" name="interval_number"/>
          <field name="interval_type">minutes</field>
          <field eval="-1" name="numbercall"/>
          <field eval="0" name="doall"/>
          <field name="model">saas.config.settings</field>
          <field name="function">launch_next_saves</field>
          <field name="args">([1])</field>
        </record> 



        <record id="image_base" model="saas.image">
            <field name="name">yolobase</field>
            <field name="current_version">1.0</field>
            <field name="dockerfile"><![CDATA[FROM debian:latest
MAINTAINER yannick.buron@gmail.com

RUN apt-get update
RUN DEBIAN_FRONTEND=noninteractive apt-get -qy install locales
ENV LANGUAGE en_US.UTF-8
ENV LANG en_US.UTF-8
ENV LC_ALL en_US.UTF-8
RUN echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
RUN DEBIAN_FRONTEND=noninteractive locale-gen en_US.UTF-8
RUN DEBIAN_FRONTEND=noninteractive dpkg-reconfigure locales
RUN update-locale LANG=en_US.UTF-8

RUN DEBIAN_FRONTEND=noninteractive apt-get install -y openssh-server supervisor vim ssmtp mailutils
#/usr/bin/mail is used by shinken. I did all I could but I couldn't make it call ssmtp for the relay to postfix container.
#Be cautious to any application which also use it.
RUN mkdir -p /var/run/sshd
RUN mkdir -p /var/log/supervisor
RUN rm /usr/bin/mail
RUN ln -s /usr/sbin/ssmtp /usr/bin/mail
#RUN echo "" > /etc/ssmtp/ssmtp.conf


RUN echo "[supervisord]" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "nodaemon=true" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "[program:sshd]" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "command=/usr/sbin/sshd -D" >> /etc/supervisor/conf.d/supervisord.conf

RUN mkdir /root/.ssh
RUN ln -s /opt/authorized_keys /root/.ssh/authorized_keys

CMD ["/usr/bin/supervisord"]
]]></field>
        </record>

        <record id="image_apache" model="saas.image">
            <field name="name">img_apache</field>
            <field name="current_version">2</field>
            <field name="dockerfile"><![CDATA[FROM yolobase:latest
MAINTAINER yannick.buron@gmail.com



RUN apt-get update

RUN DEBIAN_FRONTEND=noninteractive apt-get -y -q install apache2

RUN a2enmod ssl
RUN a2enmod proxy
RUN a2enmod proxy_http
RUN a2enmod headers
RUN echo "ServerName proxy.yolo-consulting.net" >> /etc/apache2/apache2.conf
RUN echo "NameVirtualHost *:443" >> /etc/apache2/ports.conf

RUN echo "" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "[program:apache]" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "command=/bin/bash -c 'source /etc/apache2/envvars && exec /usr/sbin/apache2 -DFOREGROUND'" >> /etc/supervisor/conf.d/supervisord.conf

RUN mkdir /var/www/.ssh
RUN ln -s /opt/authorized_keys /var/www/.ssh/authorized_keys
RUN chown -R www-data /var/www/.ssh

USER root
]]></field>
        </record>
        <record id="image_apache_volume1" model="saas.image.volume">
            <field name="image_id" ref="image_apache"/>
            <field name="name">/etc/apache2</field>
        </record>
        <record id="image_apache_volume2" model="saas.image.volume">
            <field name="image_id" ref="image_apache"/>
            <field name="name">/var/www</field>
        </record>
        <record id="image_apache_port1" model="saas.image.port">
            <field name="image_id" ref="image_apache"/>
            <field name="name">ssh</field>
            <field name="localport">22</field>
            <field name="expose">internet</field>
        </record>
        <record id="image_apache_port2" model="saas.image.port">
            <field name="image_id" ref="image_apache"/>
            <field name="name">apache</field>
            <field name="localport">80</field>
            <field name="expose">internet</field>
        </record>
        <record id="image_apache_port3" model="saas.image.port">
            <field name="image_id" ref="image_apache"/>
            <field name="name">apache-ssl</field>
            <field name="localport">443</field>
            <field name="expose">internet</field>
        </record>

    </data>
</openerp>
