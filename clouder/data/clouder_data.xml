<openerp>
    <data>

        <record id="image_base" model="clouder.image">
            <field name="name">img_base</field>
            <field name="current_version">1.0</field>
            <field name="parent_from">ubuntu-debootstrap:trusty</field>
            <field name="dockerfile"><![CDATA[

# generate a locale and ensure it on system users
RUN locale-gen en_US.UTF-8 && update-locale && echo 'LANG="en_US.UTF-8"' > /etc/default/locale
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8

# add some system packages
RUN apt-get update && apt-get -y -q install \
	sudo less \
	net-tools \
	--no-install-recommends

RUN DEBIAN_FRONTEND=noninteractive apt-get install -y vim ssmtp mailutils wget patch rsync ca-certificates

#/usr/bin/mail is used by shinken. I did all I could but I couldn't make it call ssmtp for the relay to postfix container.
#Be cautious to any application which also use it.
RUN rm /usr/bin/mail
RUN ln -s /usr/sbin/ssmtp /usr/bin/mail
#RUN echo "" > /etc/ssmtp/ssmtp.conf
]]></field>
        </record>

        <record id="image_nginx" model="clouder.image">
            <field name="name">img_nginx</field>
            <field name="current_version">1</field>
            <field name="parent_id" ref="image_base"/>
            <field name="dockerfile"><![CDATA[
RUN apt-get update

RUN DEBIAN_FRONTEND=noninteractive apt-get -y -q install supervisor nginx openssl

# nginx config
RUN sed -i -e"s/keepalive_timeout\s*65/keepalive_timeout 2/" /etc/nginx/nginx.conf
RUN echo "daemon off;" >> /etc/nginx/nginx.conf

RUN echo "[supervisord]" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "nodaemon=true" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "[program:nginx]" >> /etc/supervisor/conf.d/supervisord.conf
RUN echo "command=/etc/init.d/nginx start" >> /etc/supervisor/conf.d/supervisord.conf

USER root
CMD ["/usr/bin/supervisord"]
]]></field>
        </record>
        <record id="image_nginx_volume1" model="clouder.image.volume">
            <field name="image_id" ref="image_nginx"/>
            <field name="name">/etc/nginx</field>
        </record>
        <record id="image_nginx_volume2" model="clouder.image.volume">
            <field name="image_id" ref="image_nginx"/>
            <field name="name">/var/www</field>
        </record>
        <record id="image_nginx_volume3" model="clouder.image.volume">
            <field name="image_id" ref="image_nginx"/>
            <field name="name">/etc/ssl</field>
        </record>
        <record id="image_nginx_port1" model="clouder.image.port">
            <field name="image_id" ref="image_nginx"/>
            <field name="name">nginx</field>
            <field name="localport">80</field>
            <field name="expose">internet</field>
        </record>
        <record id="image_nginx_port2" model="clouder.image.port">
            <field name="image_id" ref="image_nginx"/>
            <field name="name">nginx-ssl</field>
            <field name="localport">443</field>
            <field name="expose">internet</field>
        </record>


    </data>
</openerp>